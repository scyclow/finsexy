<!DOCTYPE html>
<html lang="en" translate="no" class="notranslate">
<head>
  <meta charset="utf-8">
  <title>FinSexy</title>
  <link rel="shortcut icon" type="image/x-icon" href="./assets/kiss.png" id="favicon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="Chat with the hottest findoms on the internet and send them crypto">
  <meta name="keywords" content="finsexy, chatbots, ai, stable diffusion, text adventure, rpg, steviep, steve pikelny, pikelny, crypto, ethereum, nft, nfts, blockchain, bitcoin">

  <meta name="twitter:image" content="https://finsexy.com/assets/thumbnail.png">
  <meta name="twitter:image:alt" content="WARNING! The SEXY FINDOMS on this website will SUCK your wallet dry. Proceed at your own risk.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@steviepxyz">
  <meta name="twitter:site" content="@steviepxyz">
  <meta property="twitter:description" content="Chat with the hottest findoms on the internet and send them crypto">

  <meta name="og:image" property="og:image" content="https://finsexy.com/assets/thumbnail.png">
  <meta name="og:image:alt" content="WARNING! The SEXY FINDOMS on this website will SUCK your wallet dry. Proceed at your own risk.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://finsexy.com/">
  <meta property="og:title" content="FinSexy.com">
  <meta property="og:site_name" content="FinSexy">
  <meta property="og:description" content="Chat with the hottest findoms on the internet and send them crypto">


  <link rel="stylesheet" type="text/css" href="./styles.css">

  <style type="text/css">

    #messageSelector .active {
      /*background: var(--primary-color);*/
      background: linear-gradient(90deg, var(--dark-color) -75%, var(--primary-color) 100%);
      color: var(--light-color);
      box-shadow: inset 0 0 0.5em var(--secondary-color);
      text-shadow: 0 0 5px var(--dark-color);
    }

    li {
      /*box-shadow: inset 0 0 0.5em var(--border-color), 0 0 0.5em var(--border-color);*/
    }

    #messageSelector {
      list-style-type: none;
      display: flex;
      flex-direction: column;
      overflow-y: scroll;
    }
    #messageSelector li {
      cursor: pointer;
      /*border: 1px solid var(--border-color);*/
      padding: 1em;
      transition: 0.2s;
      border-bottom: 1px solid var(--border2-color);
      user-select: none;
    }

    #messageSelector li > * {
      line-height: 1.5;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    #messageSelector li:hover {
      background: var(--light-color);
      color: var(--primary-color);
      box-shadow: inset 0 0 5px var(--primary-color);
    }
    #messageSelector .active:hover {
      background: var(--light-color);
      color: var(--primary-color);
      text-shadow: none;
    }

    #messageSelector li.active > * {
      line-height: 1.5;
      overflow: visible;
      text-overflow: none;
      display: flex;
    }

    #messageSelector li:active {
      box-shadow: inset 0 0 0.5em var(--secondary-color);
      opacity: 0.8;
    }

    .chat-window.display-none {
      display: none;
    }

    .chat-window {
      height: calc(100% - 2px);
    }

    #chatWindow {
      /*width: 100%;*/
      flex:  1;
    }

    #devPanel, #profilePanel {
      width: 30vw;
      min-width: 320px;
      overflow-y: scroll;
      display: none;
    }

    .__debug #devPanel, #profilePanel {
      display: initial;
    }

    .__debug #profilePanel {
      display: none;
    }

    #devPanel {
      border-left: 1px solid var(--border-color);
      padding: 0.5em;
      background: #282828;
    }

    main {
      display: flex;
      height: calc(100% - 60px);
    }

    .a11ymode main {
      height: calc(100% - 72px);
    }

    aside {
      width: 200px;
    }


    code, code * {
      font-family: monospace;
    }

    body {
      height: 100dvh;
      max-height: 100dvh;
      flex-direction: column;
      display: flex;
    }

    .hidden {
      display: none !important;
    }

    .unread.invisible {
      visibility: hidden;
    }

    .unread {
      font-size: 0.75em;
      font-weight: bolder;

      height: 1em;
      width: 1em;
      padding: 0.5em;
      margin-left: 0.5em;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      border-radius: 50%;
      background: var(--primary-color);
      color: var(--light-color);
      box-shadow: 0 0 1em var(--primary-color);
      text-shadow: 1px 1px 0 var(--dark-color), 2px 2px 3px var(--secondary-color);

    }

    .message-selector {
      display: flex;
      justify-content: space-between;
    }

    .online {
      height: 0.5em;
      width: 0.5em;
      margin-right: 0.35em;
      border-radius: 100%;
      background: var(--green-color);
      display: inline-block;
    }

    .offline {
      opacity: 0.5;
    }


    @media (max-width: 900px) {
      #profilePanel {
        display: none;
      }
    }

    #messageSelectorSection {
      display: flex;
      flex-direction: column;
    }

    #messageSelector {
      /*box-shadow: -3px 5px 10px  var(--border-color);*/

    }
    /*#messageSelectorFiller {
      flex: 1;
      box-shadow: inset 0 0 10px var(--border-color);
    }*/

    @media (max-width: 520px) {
      .activeChat #messageSelectorSection {
        display: none;
      }

      #messageSelectorSection {
        width: 100%;
      }
      #messageSelectorSection .active {
        background: none;
        box-shadow: none;
      }
      #messageSelectorSection li:after {
        content: 'â†’';
      }

      .inactiveChat #chatWindow {
        display: none;
      }
    }

    #closeDev {
      cursor: pointer;
      float: right;
    }

  </style>

  <script src="./utils.js"></script>
  <script type="module" src="./state/all.js"></script>
  <script type="module" src="./components/all.js"></script>
</head>


<body>
  <sexy-header style="flex: 1"></sexy-header>
  <main id="main">
    <aside id="messageSelectorSection">
      <ul id="messageSelector"></ul>
      <div id="messageSelectorFiller"></div>
    </aside>

    <section id="chatWindow">

    </section>

    <aside id="profilePanel"></aside>

    <aside id="devPanel">
      <span id="closeDev">X</span>
      <h1>Dev Panel</h1>
      <div style="display: flex; justify-content: center; margin: 1em auto;">
        <button id="clearChat" style="background: var(--red-color); font-size: 1.5em;">
          Clear
        </button>
      </div>
      <code>
        <pre id="chatState">

        </pre>
      </code>
    </aside>
  </main>

  <sexy-modal id="profileModal" blur="true" >
    <sexy-user-profile slot="content"></sexy-user-profile>
  </sexy-modal>

</body>







<script type="module">
  import {MessageHandler, KatChat, HHChat} from './state/all.js'
  import {$, queryParams} from './$.js'
  import {clitLS, clearChat} from './state/clit.js'


  const $messageSelector = $.id('messageSelector')
  const $chatWindow = $.id('chatWindow')
  const $profilePanel = $.id('profilePanel')
  const $clearChat = $.id('clearChat')
  const $main = $.id('main')
  const $closeDev = $.id('closeDev')


  const $profileModal = $.id('profileModal')
  if (!ls.get('profileCompleted') && !ls.get('profileDeferred')) {
    $profileModal.open()
  }


  $clearChat.onclick = clearChat


  const messageNames = Object.keys(MessageHandler.chats)

  const sortChats = () => Object.keys(MessageHandler.chats)
    .filter(c => MessageHandler.chats[c].ctx.lastUserMessageTimestamp > 0 || c === activeChat)
    .sort((a, b) => (
      MessageHandler.chats[a].ctx.lastUserMessageTimestamp
      - MessageHandler.chats[b].ctx.lastUserMessageTimestamp
    )
  )

  const sortUnrespondedChats = () => Object.keys(MessageHandler.chats)
    .filter(c => !MessageHandler.chats[c].ctx.lastUserMessageTimestamp && MessageHandler.chats[c].ctx.lastMessageTimestamp)
    .sort((a, b) =>
      MessageHandler.chats[b].ctx.lastMessageTimestamp
      - MessageHandler.chats[a].ctx.lastMessageTimestamp
  )


  // $messageSelector.innerHTML = messageNames.map(name => `
  //   <li
  //     id="${name}-select"
  //     class="message-selector"
  //   >
  //     ${name}
  //     <span id="${name}-unread" class="unread invisible"></span>
  //   </li>
  // `).join('')


  messageNames.forEach(name => {

    const li = $.li([
      // $.span([$.span('', {class: 'online'}),name]),
      $.span(name),
      $.span('', {
        id: `${name}-unread`,
        class: `unread invisible`,
      })
    ], {
      id: `${name}-select`,
      class: `message-selector ${MessageHandler.visibilityCtx[name] === 'offline' ? 'offline' : ''}`
    })

    li.onclick = () => {
      MessageHandler.chats[name].ctx.resetUnread()
      onConvoSelect(name)
      updateDevPanel()
      updateViewedPanels()
    }

    $.render($messageSelector, li)
  })


  $chatWindow.innerHTML = messageNames.map(name => `
    <chat-window id="${name}-chat" name="${name}" class="chat-window"></chat-window>
  `).join('')



  messageNames.forEach(name => {
    const $window = $.id(`${name}-chat`)
    MessageHandler.chats[name].addChatWindow($window)
  })


  let activeChat
  const onConvoSelect = (id, ignoreHistory=false, delayFocus=false) => {
    const url = new URL(window.location)
    const existingActiveChat = url.searchParams.get('activeChat')
    url.searchParams.set('activeChat', id)

    if (!ignoreHistory && existingActiveChat !== id) window.history.pushState({ activeChat }, '', url.toString())


    if (!ignoreHistory && activeChat === id) return
    activeChat = id

    const activeChatWindow = $.id(id + '-chat')

    setTimeout(() => {
      activeChatWindow.shadowRoot.getElementById('input').focus()
      activeChatWindow.focus()
    }, delayFocus ? 500 : 0)


    $.cls('message-selector').forEach(ms => {
      ms.classList.remove('active')
    })

    $.cls('chat-window').forEach(cw => {
      cw.classList.add('display-none')
    })

    $.id(id + '-select').classList.add('active')
    activeChatWindow.classList.remove('display-none')
    activeChatWindow.scroll()

    Object.keys(MessageHandler.chats).forEach(k => {
      if (k === activeChat) {

        if (queryParams.activeChat || window.innerWidth > 520) {
          MessageHandler.chats[k].isActive = true
          MessageHandler.chats[k].ctx.resetUnread()
        }

      } else {
        MessageHandler.chats[k].isActive = false
      }
    })

    $profilePanel.innerHTML = `<sexy-profile name="${id}" sideWindow="true"></sexy-profile>`
    $profilePanel.scrollTo(0,0)
  }


  const topChat = (last(sortChats()) || 'heatherHot')


  activeChat = Object.keys(MessageHandler.chats).includes(queryParams.activeChat)
    ? queryParams.activeChat
    : topChat

  setTimeout(() => {
    onConvoSelect(activeChat, true, true)
  })



  const updateDevPanel = () => {
    const showDev = clitLS.get('devMode')

    if (showDev) {
      document.body.classList.add('__debug')
    } else {
      document.body.classList.remove('__debug')
    }

    const chat = MessageHandler.chats[activeChat]
    $.id('chatState').innerText = JSON.stringify(
      {...chat.ctx, history: chat.ctx.history},
      null,
      4
    )
  }

  updateDevPanel()
  $.cls('chat-window').forEach(chatWindow => {
    chatWindow.registerEventHandler('submit', updateDevPanel)
    chatWindow.registerEventHandler('submit', updateViewedPanels)

  })


  setInterval(() => {
    updateDevPanel()
    updateViewedPanels()
  }, 1000)


  // setRunInterval(() => {
  //   if (!clitLS.get().devMode) return
  //   const chat = MessageHandler.chats[activeChat]
  //   if (chat) {
  //     $.id('chatState').innerText = JSON.stringify(
  //       {...chat.ctx, history: chat.ctx.history},
  //       null,
  //       4
  //     )
  //   }

  //   // $.id('chatState').innerHTML += Object.keys(MessageHandler.chats).map(m => {
  //   //   if (MessageHandler.chats[m]) {
  //   //     return `
  //   //       <div>${m}: ${MessageHandler.chats[m].ctx.unread}</div>
  //   //     `
  //   //   } else {
  //   //     return ''
  //   //   }
  //   // }
  //   // ).join('')

  // }, 300)


  let orderedChats = []
  function updateViewedPanels() {
    if (!document.hidden && queryParams.activeChat || window.innerWidth > 520) {
      MessageHandler.chats[activeChat].ctx.resetUnread()
    }

    const order = [...sortUnrespondedChats(), ...sortChats()]

    let _orderedChats = []

    Object.keys(MessageHandler.chats).forEach(m => {
      const $unread = $.id(`${m}-unread`)
      const $select = $.id(`${m}-select`)

      const unreadCount = MessageHandler.chats[m].ctx.unread
      if ($unread && unreadCount) {
        $unread.innerHTML = unreadCount
        $unread.classList.remove('invisible')
      } else if ($unread) {
        $unread.innerHTML = ''
        $unread.classList.add('invisible')
      }

      const isActive = activeChat === m
      const hideHeather = !isActive && m === 'heatherHot' && MessageHandler.globalCtx.hideHeather

      const messageCount = MessageHandler.chats[m].ctx.history.length
      if (hideHeather || $select && !messageCount && !isActive) {
        $select.classList.add('hidden')
      } else if ($select && messageCount) {
        $select.classList.remove('hidden')
      }


      if (m === activeChat && !messageCount) {
        $select.style.order = 1
        _orderedChats.push({ name: m, order: 99 })

      } else if ($select) {
        const o = order.findIndex(name => name === m)
        $select.style.order = 100 - o
        if (messageCount) _orderedChats.push({ name: m, order: o })
      }
    })
    orderedChats = _orderedChats.sort((a, b) => b.order - a.order)
    adjustUI()

  }
  updateViewedPanels()


  // setInterval(() => , 250)

  // $heatherHotSelect.onclick = () => {
  //   $heatherHotSelect.classList.add
  // }




  setTimeout(() => {
    // if (!KatChat.ctx.history.length && !KatChat.ctx.eventQueue.length) {
    //   KatChat.queueEvent('steviep', 60000)
    // }
    if (!HHChat.ctx.history.length && !HHChat.ctx.eventQueue.length) {
      HHChat.queueEvent('hi', 3000)
    }


    // ls.set('returnVisit', true)
  }, 1000)

  window.addEventListener('popstate', () => {
    const u = new URL(window.location)
    const activeChat = u.searchParams.get('activeChat')
    onConvoSelect(activeChat || topChat, true)
    adjustUI()
  })

  function adjustUI() {
    const u = new URL(window.location)
    const activeChat = u.searchParams.get('activeChat')

    if (activeChat) {
      $main.classList.add('activeChat')
      $main.classList.remove('inactiveChat')
    } else {
      $main.classList.remove('activeChat')
      $main.classList.add('inactiveChat')
    }
  }



  document.body.addEventListener('keydown', (e) => {

    if (e.key === 'ArrowDown' && e.metaKey) {
      const activeIx = orderedChats.findIndex(s => activeChat === s.name)
      const newActiveChat = orderedChats[(activeIx + 1) % orderedChats.length]
      onConvoSelect(newActiveChat.name)
    }
    else if (e.key === 'ArrowUp' && e.metaKey) {
      const activeIx = orderedChats.findIndex(s => activeChat === s.name)
      const newActiveChat = orderedChats[(orderedChats.length + activeIx - 1) % orderedChats.length]
      onConvoSelect(newActiveChat.name)
    }
  })


  $.id('closeDev').onclick = (e) => {
    clitLS.set('devMode', false)
  }


</script>


























</html>