<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" type="text/css" href="./styles.css">
  <style type="text/css">

    #messageSelector .active {
      background: var(--primary-color);
      color: var(--light-color);
    }

    #messageSelector {
      list-style-type: none;
    }
    #messageSelector li {
      cursor: pointer;
      border: 1px solid var(--border-color);
      padding: 1em;
      transition: 0.2s;
    }
    #messageSelector li:hover {
      background: #ff66ff;
    }
    #messageSelector .active:hover {
      background: #ff66ff;
    }

    .chat-window.display-none {
      display: none;
    }

    .chat-window {
      height: calc(100% - 2px);
    }

    #chatWindow {
      height: calc(100vh - 60px);
      width: 100%;
    }

    main {
      display: flex;
    }

    code, code *{
      font-family: monospace;
    }

  </style>
</head>
<body>
  <sexy-header></sexy-header>
  <main>
    <aside>
      <ul id="messageSelector">

      </ul>
    </aside>

    <section id="chatWindow">

    </section>

    <aside style="width: 50vw; height: calc(100vh - 60px);overflow: scroll;">
      <h1>Test panel</h1>
      <code>
        <pre id="chatState">

        </pre>
      </code>
    </aside>

  </main>


<!--
    <react-style-component id="component1"></react-style-component>
    <react-style-component id="component2"></react-style-component>
    <react-style-component id="component3"></react-style-component>

    <div>hello</div> -->
</body>

<script src="./$.js"></script>
<script src="./utils.js"></script>
<script src="./profile.js"></script>
<script src="./conversationRunner.js"></script>
<script src="./header.js"></script>



<script type="text/javascript">

  const $messageSelector = $.id('messageSelector')
  const $chatWindow = $.id('chatWindow')

  const messageNames = [
    'heatherHot',
    'cagla',
    'samanthaJones',
    'VinceSlickson'
  ]

  $messageSelector.innerHTML = messageNames.map(m => `
    <li
      id="${m}-select"
      class="message-selector"
      onclick="onConvoSelect('${m}')"
    >
      ${m}
    </li>
  `).join('')

  $messageSelector.innerHTML += `
    <li>
      <button onclick="localStorage.clear(); window.location.reload()">clear</button>
    </li>
  `

  $chatWindow.innerHTML = messageNames.map(m => `
    <chat-window id="${m}-chat" name="${m}" class="chat-window"></chat-window>
  `).join('')


  let activeChat
  const onConvoSelect = (id) => {
    activeChat = id

    const activeChatWindow = $.id(id + '-chat')

    $.cls('message-selector').forEach(ms => {
      ms.classList.remove('active')
    })

    $.cls('chat-window').forEach(cw => {
      cw.classList.add('display-none')
    })

    $.id(id + '-select').classList.add('active')
    activeChatWindow.classList.remove('display-none')
    activeChatWindow.scroll()

    const url = new URL(window.location)
    url.searchParams.set('activeChat', activeChat)
    window.history.pushState({}, '', url)
  }


  activeChat = messageNames.includes(queryParams.activeChat)
    ? queryParams.activeChat
    : 'heatherHot'

  onConvoSelect(activeChat)

  setRunInterval(() => {
    const chat = MessageHandler.chats[activeChat.toLowerCase()]
    if (chat) {
      $.id('chatState').innerHTML = JSON.stringify(
        {...chat.ctx, history: chat.ctx.history},
        null,
        4
      )
    }
  }, 10)

  // $heatherHotSelect.onclick = () => {
  //   $heatherHotSelect.classList.add
  // }












// const ApplicationStateHandlers = []
// const ApplicationState = {
//   chat: {
//     active: 'heatherHot',
//     participants: {
//       heatherHot: [],
//       CandyCrush: [],
//       GoddessJessica: [],
//     }
//   },
// }

// const getState = path => path.split('.').reduce((s, p) => s[p], ApplicationState)

// const updateState = (path, value) => {
//   const pathVals = path.split('.')
//   const node = pathVals.slice(0, -1).reduce((s, p) => s[p], ApplicationState)
//   const lastProp = pathVals.slice(-1)[0]
//   node[lastProp] = value


//   ApplicationStateHandlers.forEach(handler => handler(ApplicationState))
// }



// class ChatContext {
//   constructor() {
//     this.history = []
//     this.warnings = 0
//     this.stack = []

//   }
// }
</script>


<script src="./chats/heatherHot.js"></script>
<script src="./chats/cagla.js"></script>
<script src="./chats/samanthaJones.js"></script>
<script src="./chats/vinceSlickson.js"></script>
























</html>